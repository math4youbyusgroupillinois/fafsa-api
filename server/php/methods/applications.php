<?php$route = '/applications/';$app->get($route, function ()  use ($app,$three_scale_provider_key){	$ReturnObject = array(); 	$request = $app->request();  	$_GET = $request->params();		if(isset($_GET['fields'])){ $fields = $_GET['fields']; } else { $fields = '*';}		// Need to validate fields against data model		// Incoming Keys	$appid = $_GET['appid'];	$appkey = $_GET['appkey'];		$client = new ThreeScaleClient($three_scale_provider_key);		// Auth the application	$response = $client->authorize($appid, $appkey);		//var_dump($response);	// Check the response type	if ($response->isSuccess()) {					$Query = "SELECT " . mysql_real_escape_string($fields) . " FROM application";		$Query .= " WHERE appid = '" . $appid . "'";		$Query .= " ORDER BY last_name ASC";		$Query .= " LIMIT 25";				//echo $Query . "<br />";		$LinkResult = mysql_query($Query) or die('Query failed: ' . mysql_error());		  		while ($Link = mysql_fetch_assoc($LinkResult))			{			$F = array();				foreach($Link as $key => $value){				$F[$key] = $value;							}			array_push($ReturnObject, $F);				}			$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($ReturnObject));			} else {				$ErrorMessage = $response->getErrorMessage();				$E = array();													$E['Message'] = $ErrorMessage;				$app->response()->status(403);			$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($E));							}					});$route = '/applications/:fafsa_id';$app->get($route, function ($fafsa_id)  use ($app,$three_scale_provider_key){	$ReturnObject = array(); 	$request = $app->request();  	$_GET = $request->params();		if(isset($_GET['fields'])){ $fields = $_GET['fields']; } else { $fields = '*';}		// Need to validate fields against data model		// Incoming Keys	$appid = $_GET['appid'];	$appkey = $_GET['appkey'];		$client = new ThreeScaleClient($three_scale_provider_key);		// Auth the application	$response = $client->authorize($appid, $appkey);		//var_dump($response);	// Check the response type	if ($response->isSuccess()) {			// Need to validate fields against data model					$Query = "SELECT " . mysql_real_escape_string($fields) . " FROM application";		$Query .= " WHERE fafsa_id = '" . mysql_real_escape_string($fafsa_id) . "'";		//echo $Query . "<br />";		$LinkResult = mysql_query($Query) or die('Query failed: ' . mysql_error());		  		while ($Link = mysql_fetch_assoc($LinkResult))			{			$F = array();				foreach($Link as $key => $value){				$F[$key] = $value;							}			array_push($ReturnObject, $F);				}			$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($ReturnObject));			} else {				$ErrorMessage = $response->getErrorMessage();				$E = array();													$E['Message'] = $ErrorMessage;				$app->response()->status(403);			$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($E));							}					});	$route = '/applications/';	$app->post($route, function () use ($app,$three_scale_provider_key){		$Add = 1;	$ReturnObject = array();	 	$request = $app->request();  	$_POST = $request->params();			if(isset($_POST['first_name'])){ $first_name = $_POST['first_name']; } elseif(isset($_POST['first_name'])){ $first_name = $_REQUEST['first_name']; } else { $first_name = ''; $Add = 0; }		if(isset($_POST['last_name'])){ $last_name = $_POST['last_name']; } elseif(isset($_POST['last_name'])){ $last_name = $_REQUEST['last_name']; } else { $last_name = ''; $Add = 0; }		if(isset($_POST['students_email_address'])){ $students_email_address = $_POST['students_email_address']; } elseif(isset($_POST['students_email_address'])){ $students_email_address = $_REQUEST['students_email_address']; } else { $students_email_address = ''; $Add = 0; }				// Incoming Keys	$appid = $_POST['appid'];	$appkey = $_POST['appkey'];		$client = new ThreeScaleClient($three_scale_provider_key);		// Auth the application	$response = $client->authorize($appid, $appkey);		//var_dump($response);	// Check the response type	if ($response->isSuccess()) {					// Go ahead and create		if($Add==1){						$fafsa_id = $first_name . "-" . $last_name . "-" . $students_email_address;			$fafsa_id = md5($fafsa_id);					  	$AppQuery = "SELECT fafsa_id,first_name,last_name,students_email_address FROM application WHERE fafsa_id = '" . mysql_real_escape_string($fafsa_id) . "' AND appid = '" . mysql_real_escape_string($appid) . "'";			//echo $AppQuery . "<br />";			$AppResult = mysql_query($AppQuery) or die('Query failed: ' . mysql_error());						if($AppResult && mysql_num_rows($AppResult))				{					$App = mysql_fetch_assoc($AppResult);									$F = array();				$F['fafsa_id'] = $App['fafsa_id'];				$F['first_name'] = $App['first_name'];				$F['last_name'] = $App['last_name'];				$F['students_email_address'] = $App['students_email_address'];				array_push($ReturnObject, $F);												}			else 				{				$InsertAppQuery = "INSERT INTO application(first_name,last_name,students_email_address,fafsa_id,appid)";				$InsertAppQuery .= " VALUES(";								$InsertAppQuery .= "'" . mysql_real_escape_string($first_name) . "',";				$InsertAppQuery .= "'" . mysql_real_escape_string($last_name) . "',";				$InsertAppQuery .= "'" . mysql_real_escape_string($students_email_address) . "',";				$InsertAppQuery .= "'" . mysql_real_escape_string($fafsa_id) . "'";				$InsertAppQuery .= "'" . mysql_real_escape_string($appid) . "'";								$InsertAppQuery .= ")";				//echo $InsertAppQuery . "<br />";				mysql_query($InsertAppQuery) or die('Query failed: ' . mysql_error());										$F = array();				$F['fafsa_id'] = $fafsa_id;				$F['first_name'] = $first_name;				$F['last_name'] = $last_name;				$F['students_email_address'] = $students_email_address;				array_push($ReturnObject, $F);										}								$app->response()->header("Content-Type", "application/json");			echo format_json(json_encode($ReturnObject));																				}		else{						$F = array();			$F['error'] = 'Make sure and provide complete first_name, last_name and students_email_address';			array_push($ReturnObject, $F);											$app->response()->header("Content-Type", "application/json");			$app->response()->status(500);			echo format_json(json_encode($ReturnObject));						}			} else {				$ErrorMessage = $response->getErrorMessage();				$E = array();													$E['Message'] = $ErrorMessage;				$app->response()->status(403);			$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($E));							}					});$route = '/applications/:fafsa_id';	$app->put($route, function ($fafsa_id) use ($app,$three_scale_provider_key){	 	$request = $app->request();  	$_PUT = $request->params();	// Incoming Keys	$appid = $_PUT['appid'];	$appkey = $_PUT['appkey'];		$client = new ThreeScaleClient($three_scale_provider_key);		// Auth the application	$response = $client->authorize($appid, $appkey);		//var_dump($response);	// Check the response type	if ($response->isSuccess()) {				  	$AppQuery = "SELECT fafsa_id FROM application WHERE fafsa_id = '" . mysql_real_escape_string($fafsa_id) . "'";		//echo $AppQuery . "<br />";		$AppResult = mysql_query($AppQuery) or die('Query failed: ' . mysql_error());				if($AppResult && mysql_num_rows($AppResult))			{				$App = mysql_fetch_assoc($AppResult);					$UpdateSQL = "UPDATE application SET ";				foreach($_PUT as $key => $value){				if($key!='appid' && $key!='appkey'){					$UpdateSQL .= $key . "='" . mysql_real_escape_string(urldecode($value)) . "', ";					}				}						$UpdateSQL = substr($UpdateSQL, 0,strlen($UpdateSQL)-2);			$UpdateSQL .= " WHERE fafsa_id = '" . $fafsa_id . "'";						//echo $UpdateSQL . "<br />";			mysql_query($UpdateSQL) or die('Query failed: ' . mysql_error());  						$app->response()->status(200);						}		else {
			$app->response()->status(400);
		}				} else {				$ErrorMessage = $response->getErrorMessage();				$E = array();													$E['Message'] = $ErrorMessage;				$app->response()->status(403);			$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($E));							}					});$route = '/applications/:fafsa_id';$app->delete($route, function ($fafsa_id) use ($app,$three_scale_provider_key){	 	$request = $app->request();  	$_DELETE = $request->params();			// Incoming Keys	$appid = $_DELETE['appid'];	$appkey = $_DELETE['appkey'];		$client = new ThreeScaleClient($three_scale_provider_key);		// Auth the application	$response = $client->authorize($appid, $appkey);		//var_dump($response);	// Check the response type	if ($response->isSuccess()) {				  	$AppQuery = "SELECT fafsa_id FROM application WHERE fafsa_id = '" . mysql_real_escape_string($fafsa_id) . "'";		//echo $AppQuery . "<br />";		$AppResult = mysql_query($AppQuery) or die('Query failed: ' . mysql_error());				if($AppResult && mysql_num_rows($AppResult))			{				$App = mysql_fetch_assoc($AppResult);					$UpdateSQL = "DELETE FROM application WHERE fafsa_id = '" . $fafsa_id . "'";					//echo $UpdateSQL . "<br />";			mysql_query($UpdateSQL) or die('Query failed: ' . mysql_error());  						$app->response()->status(200);						}		else {			$app->response()->status(400);		}			} else {				$ErrorMessage = $response->getErrorMessage();				$E = array();													$E['Message'] = $ErrorMessage;				$app->response()->status(403);			$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($E));							}					});	?>